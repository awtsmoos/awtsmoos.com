<!--B"H-->
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Simple Video Editor</title>
  <style>
    body { font-family: sans-serif; background: #111; color: #eee; }
    #bin { border: 1px solid #444; padding: 10px; margin: 10px; }
    #binItems { display: flex; gap: 10px; flex-wrap: wrap; }
    .bin-item { width: 100px; height: 100px; background: #222; display: flex; align-items: center; justify-content: center; cursor: pointer; }
    #timelineContainer { border: 1px solid #444; padding: 10px; margin: 10px; position: relative; }
    #timeline { position: relative; height: 150px; background: #333; overflow: hidden; }
    .timeline-item { position: absolute; top: 10px; height: 130px; border: 2px solid #888; cursor: move; }
    .resize-handle { position: absolute; top: 0; width: 5px; height: 100%; background: #fff; cursor: ew-resize; }
    .resize-left { left: -5px; }
    .resize-right { right: -5px; }
    #playhead { position: absolute; top: 0; bottom: 0; width: 2px; background: red; }
    #controls { margin: 10px; }
  </style>
</head>
<body>
  <div id="bin">
    <h2>Media Bin</h2>
    <input type="file" id="fileInput" multiple accept="audio/*,image/*">
    <div id="binItems"></div>
  </div>
  <div id="timelineContainer">
    <h2>Timeline</h2>
    <div id="timeline"></div>
  </div>
  <div id="controls">
    <button id="playBtn">Play</button>
    <button id="pauseBtn">Pause</button>
    <button id="cutBtn">Cut</button>
  </div>
  <audio id="audioPlayer"></audio>
  <script>
    // Basic variables and sacred constants
    const fileInput = document.getElementById('fileInput');
    const binItems = document.getElementById('binItems');
    const timeline = document.getElementById('timeline');
    const playBtn = document.getElementById('playBtn');
    const pauseBtn = document.getElementById('pauseBtn');
    const cutBtn = document.getElementById('cutBtn');
    const audioPlayer = document.getElementById('audioPlayer');

    let timelineItems = [];
    let selectedItem = null;
    let audioDuration = 60; // default duration in seconds

    // Conversion factor: pixels per second—a measure of the divine rhythm
    function updateTimeScale() {
      return timeline.offsetWidth / audioDuration;
    }

    // Upon file import, the bin becomes a repository of potential miracles
    fileInput.addEventListener('change', (e) => {
      const files = Array.from(e.target.files);
      files.forEach(file => {
        const url = URL.createObjectURL(file);
        if(file.type.startsWith('image/')) {
          const div = document.createElement('div');
          div.className = 'bin-item';
          const img = document.createElement('img');
          img.src = url;
          img.style.maxWidth = '100%';
          img.style.maxHeight = '100%';
          div.appendChild(img);
          div.dataset.type = 'image';
          div.dataset.url = url;
          binItems.appendChild(div);
          // Summon a timeline object with a single click
          div.addEventListener('click', () => {
            const item = createTimelineItem(url, 'image');
            timelineItems.push(item);
            timeline.appendChild(item.element);
          });
        } else if(file.type.startsWith('audio/')) {
          // Bind the first audio as the heartbeat of the timeline
          if(!audioPlayer.src) {
            audioPlayer.src = url;
            audioPlayer.onloadedmetadata = () => {
              audioDuration = audioPlayer.duration;
            }
          }
          const div = document.createElement('div');
          div.className = 'bin-item';
          div.textContent = 'Audio';
          div.dataset.type = 'audio';
          div.dataset.url = url;
          binItems.appendChild(div);
        }
      });
    });

    // Creation of a timeline item—a fragment of the eternal vision
    function createTimelineItem(url, type) {
      const itemEl = document.createElement('div');
      itemEl.className = 'timeline-item';
      const startTime = 0;
      const duration = 5; // seconds, a fleeting moment of captured light
      itemEl.style.left = (startTime * updateTimeScale()) + 'px';
      itemEl.style.width = (duration * updateTimeScale()) + 'px';
      if(type === 'image'){
        const img = document.createElement('img');
        img.src = url;
        img.style.width = '100%';
        img.style.height = '100%';
        img.style.objectFit = 'cover';
        itemEl.appendChild(img);
        // Upon playback, the image shall gently zoom and shift, as if drawn by the hand of Awtsmoos
      }
      // Carve out the handles for resizing—the tools of transformation
      const leftHandle = document.createElement('div');
      leftHandle.className = 'resize-handle resize-left';
      const rightHandle = document.createElement('div');
      rightHandle.className = 'resize-handle resize-right';
      itemEl.appendChild(leftHandle);
      itemEl.appendChild(rightHandle);

      const item = { start: startTime, duration: duration, element: itemEl, type: type };

      // Enable dragging: a slow dance along the timeline of destiny
      itemEl.addEventListener('mousedown', (e) => {
        if(e.target.classList.contains('resize-handle')) return;
        selectedItem = item;
        const startX = e.clientX;
        const origLeft = parseFloat(itemEl.style.left);
        const onMouseMove = (ev) => {
          const dx = ev.clientX - startX;
          let newLeft = origLeft + dx;
          if(newLeft < 0) newLeft = 0;
          item.start = newLeft / updateTimeScale();
          itemEl.style.left = newLeft + 'px';
        }
        const onMouseUp = () => {
          document.removeEventListener('mousemove', onMouseMove);
          document.removeEventListener('mouseup', onMouseUp);
        }
        document.addEventListener('mousemove', onMouseMove);
        document.addEventListener('mouseup', onMouseUp);
      });

      // Left handle: the power to retract time itself
      leftHandle.addEventListener('mousedown', (e) => {
        e.stopPropagation();
        selectedItem = item;
        const startX = e.clientX;
        const origLeft = parseFloat(itemEl.style.left);
        const origWidth = parseFloat(itemEl.style.width);
        const onMouseMove = (ev) => {
          const dx = ev.clientX - startX;
          let newLeft = origLeft + dx;
          let newWidth = origWidth - dx;
          if(newLeft < 0) {
            newWidth += newLeft;
            newLeft = 0;
          }
          if(newWidth < 10) newWidth = 10;
          item.start = newLeft / updateTimeScale();
          item.duration = newWidth / updateTimeScale();
          itemEl.style.left = newLeft + 'px';
          itemEl.style.width = newWidth + 'px';
        }
        const onMouseUp = () => {
          document.removeEventListener('mousemove', onMouseMove);
          document.removeEventListener('mouseup', onMouseUp);
        }
        document.addEventListener('mousemove', onMouseMove);
        document.addEventListener('mouseup', onMouseUp);
      });

      // Right handle: the ability to extend the moment of creation
      rightHandle.addEventListener('mousedown', (e) => {
        e.stopPropagation();
        selectedItem = item;
        const startX = e.clientX;
        const origWidth = parseFloat(itemEl.style.width);
        const onMouseMove = (ev) => {
          const dx = ev.clientX - startX;
          let newWidth = origWidth + dx;
          if(newWidth < 10) newWidth = 10;
          item.duration = newWidth / updateTimeScale();
          itemEl.style.width = newWidth + 'px';
        }
        const onMouseUp = () => {
          document.removeEventListener('mousemove', onMouseMove);
          document.removeEventListener('mouseup', onMouseUp);
        }
        document.addEventListener('mousemove', onMouseMove);
        document.addEventListener('mouseup', onMouseUp);
      });

      return item;
    }

    // When the divine playback commences, the Awtsmoos whispers life into every image
    playBtn.addEventListener('click', () => {
      audioPlayer.play();
      startTimeline();
      timelineItems.forEach(item => {
        if(item.type === 'image'){
          item.element.firstChild.style.transition = 'transform ' + item.duration + 's linear';
          item.element.firstChild.style.transform = 'scale(1.1) translateX(10px)';
        }
      });
    });

    pauseBtn.addEventListener('click', () => {
      audioPlayer.pause();
    });

    // The playhead—a luminous blade slicing through time—reveals the progress of creation
    let playhead = document.createElement('div');
    playhead.id = 'playhead';
    timeline.appendChild(playhead);

    function startTimeline(){
      function update(){
        const currentTime = audioPlayer.currentTime;
        playhead.style.left = (currentTime * updateTimeScale()) + 'px';
        if(!audioPlayer.paused){
          requestAnimationFrame(update);
        }
      }
      update();
    }

    // The cut tool: a decisive strike splitting a moment into two, echoing the relentless duality of existence
    cutBtn.addEventListener('click', () => {
      if(selectedItem){
        const cutTime = audioPlayer.currentTime;
        if(cutTime > selectedItem.start && cutTime < selectedItem.start + selectedItem.duration){
          const leftDuration = cutTime - selectedItem.start;
          const rightDuration = (selectedItem.start + selectedItem.duration) - cutTime;
          selectedItem.duration = leftDuration;
          selectedItem.element.style.width = (leftDuration * updateTimeScale()) + 'px';
          const newItem = {
            start: cutTime,
            duration: rightDuration,
            type: selectedItem.type,
            element: selectedItem.element.cloneNode(true)
          };
          newItem.element.style.left = (cutTime * updateTimeScale()) + 'px';
          timelineItems.push(newItem);
          timeline.appendChild(newItem.element);
        }
      }
    });
  </script>
</body>
</html>
